# [7차시] 제조 데이터 전처리 (1) - 강사 스크립트

## 강의 정보
- **차시**: 7차시 (25-30분)
- **유형**: 이론 + 실습
- **구성**: 이론 10분 + 실습 15-20분
- **대상**: 비전공자, AI 입문자, 제조업 종사자

---

## 이론편 (10분)

### 도입 (2분)

#### 인사 및 지난 시간 복습 [1분]

> 안녕하세요, 7차시를 시작하겠습니다.
>
> 지난 시간에 상관분석과 선형회귀를 배웠죠? 두 변수의 관계를 분석하고 예측하는 방법을 익혔습니다.
>
> 오늘부터는 **데이터 전처리**를 배웁니다. 실제 데이터는 완벽하지 않거든요. 결측치도 있고, 이상치도 있습니다.

#### 학습목표 안내 [1분]

> 오늘 수업을 마치면 다음 세 가지를 할 수 있습니다.
>
> 첫째, 결측치를 탐지하고 적절히 처리합니다.
> 둘째, 이상치를 탐지하는 방법을 적용합니다.
> 셋째, 상황에 맞는 전처리 전략을 선택합니다.
>
> 전처리는 데이터 분석에서 가장 많은 시간이 걸리는 단계입니다. 잘 배워두세요.

---

### 핵심 내용 (8분)

#### 왜 전처리가 중요한가? [1분]

> 데이터 분석 프로젝트에서 시간이 어디에 가장 많이 쓰일까요?
>
> 놀랍게도 **데이터 수집과 전처리에 60~80%**의 시간이 들어갑니다. 모델링은 10~20%밖에 안 돼요.
>
> **"Garbage In, Garbage Out"**이라는 말이 있습니다. 나쁜 데이터를 넣으면 나쁜 결과가 나온다는 뜻이에요.
>
> 그래서 전처리가 중요합니다.

#### 결측치란? [1.5분]

> **결측치**는 비어있는 값입니다.
>
> 제조 현장에서는 어떻게 발생할까요?
>
> 센서 오류로 통신이 끊기거나, 배터리가 방전되면 데이터가 안 들어옵니다.
> 수기 입력 시 실수로 누락될 수도 있고요.
> MES나 PLC 시스템 장애로 데이터가 손실되기도 합니다.
>
> pandas에서는 `np.nan`, `None`, `pd.NA`로 표현됩니다.
>
> 결측치를 확인하려면 `df.isnull().sum()`을 사용합니다.

#### 결측치 처리 전략 [1.5분]

> 결측치를 어떻게 처리할까요? 크게 두 가지 방법이 있습니다.
>
> 첫째, **삭제**. `df.dropna()`로 결측치가 있는 행을 제거합니다. 결측치가 5% 미만일 때 사용합니다.
>
> 둘째, **대체**. `df.fillna()`로 다른 값으로 채웁니다.
> - 평균이나 중앙값으로 채우는 게 일반적입니다.
> - 이상치가 있으면 평균보다 중앙값이 낫습니다.
> - 시계열 데이터면 앞이나 뒤 값으로 채우기도 합니다.
>
> 결측 비율이 20%를 넘으면 해당 열을 삭제하는 것도 고려해보세요.

#### 이상치란? [1.5분]

> **이상치**는 비정상적으로 극단적인 값입니다.
>
> 제조 현장에서는 왜 발생할까요?
>
> 센서가 고장 나거나 캘리브레이션이 안 되면 이상한 값이 나옵니다.
> 데이터 입력 시 단위를 잘못 쓰거나 오타가 나기도 하죠.
> 또는 실제로 공정 이탈이나 설비 고장으로 극단값이 발생할 수도 있습니다.
>
> 중요한 질문이 있어요. **이상치가 오류인가, 중요한 신호인가?**
>
> 불량 예측 모델을 만든다면 이상치가 오히려 핵심 정보일 수 있습니다.

#### 이상치 탐지 방법 [1.5분]

> 이상치를 어떻게 찾을까요? 두 가지 방법을 배웁니다.
>
> 첫째, **IQR 방법**. 상자그림에서 쓰는 방법입니다.
> Q1(25%)과 Q3(75%)를 구하고, IQR = Q3 - Q1을 계산합니다.
> Q1 - 1.5×IQR 미만이거나 Q3 + 1.5×IQR 초과면 이상치입니다.
>
> 둘째, **Z-score 방법**. 지난 시간에 배웠죠?
> Z = (값 - 평균) / 표준편차
> |Z| > 3이면 이상치로 판단합니다.
>
> 이상치 처리는 삭제, 클리핑, 대체 등이 있는데, 상황에 맞게 선택해야 합니다.

#### 주의사항 [1분]

> 중요한 주의사항입니다.
>
> **이상치를 무조건 제거하면 안 됩니다!**
>
> 분석 목적에 따라 달라요. 불량품 예측이 목적이면 이상치가 핵심 정보입니다.
> 반면 평균 생산량을 추정하는 거라면 이상치 제거를 고려할 수 있죠.
>
> 항상 도메인 전문가와 상의하고, 원인을 파악하고, 전후 분포를 비교하세요.

---

## 실습편 (15-20분)

### 실습 소개 [2분]

> 이제 실습 시간입니다. 오늘은 결측치와 이상치가 있는 제조 데이터를 전처리해보겠습니다.
>
> **실습 환경**을 확인해주세요.
>
> ```python
> import numpy as np
> import pandas as pd
> import matplotlib.pyplot as plt
>
> plt.rcParams['font.family'] = 'Malgun Gothic'
> plt.rcParams['axes.unicode_minus'] = False
> ```
>
> 모두 준비되셨으면 시작하겠습니다.

### 실습 1: 결측치 있는 데이터 생성 [2분]

> 첫 번째 실습입니다. 결측치가 포함된 샘플 데이터를 만들어봅시다.
>
> ```python
> np.random.seed(42)
> n = 100
>
> df = pd.DataFrame({
>     '일자': pd.date_range('2024-01-01', periods=n),
>     '온도': np.random.normal(85, 5, n),
>     '생산량': np.random.normal(1200, 50, n),
>     '불량수': np.random.poisson(30, n),
>     '라인': np.random.choice(['A', 'B', 'C'], n)
> })
>
> # 결측치 삽입
> missing_idx = np.random.choice(n, 10, replace=False)
> df.loc[missing_idx, '온도'] = np.nan
> ```
>
> 10개의 온도 데이터를 결측치로 만들었습니다.

### 실습 2: 결측치 탐지 [2분]

> 두 번째 실습입니다. 결측치를 탐지해봅시다.
>
> ```python
> print("=== 결측치 현황 ===")
> print(df.isnull().sum())
>
> missing_ratio = (df.isnull().sum() / len(df) * 100).round(2)
> print("\n=== 결측 비율 (%) ===")
> print(missing_ratio)
> ```
>
> 온도에 10%, 생산량에 5%의 결측치가 있습니다.

### 실습 3: 결측치 처리 [2분]

> 세 번째 실습입니다. 결측치를 처리해봅시다.
>
> ```python
> df_clean = df.copy()
>
> temp_median = df_clean['온도'].median()
> df_clean['온도'].fillna(temp_median, inplace=True)
> print(f"온도 결측치를 {temp_median:.1f}도로 대체")
>
> print(f"처리 후 결측치: {df_clean.isnull().sum().sum()}개")
> ```
>
> 중앙값으로 대체했습니다. 평균보다 이상치에 강건하기 때문이에요.

### 실습 4: 이상치 삽입 및 탐지 [3분]

> 네 번째 실습입니다. 이상치를 삽입하고 IQR로 탐지해봅시다.
>
> ```python
> df_clean.loc[5, '생산량'] = 2000   # 매우 높음
> df_clean.loc[15, '생산량'] = 500   # 매우 낮음
>
> Q1 = df_clean['생산량'].quantile(0.25)
> Q3 = df_clean['생산량'].quantile(0.75)
> IQR = Q3 - Q1
>
> lower = Q1 - 1.5 * IQR
> upper = Q3 + 1.5 * IQR
>
> outliers = (df_clean['생산량'] < lower) | (df_clean['생산량'] > upper)
> print(f"이상치 개수: {outliers.sum()}개")
> ```
>
> IQR 방법으로 이상치를 찾았습니다.

### 실습 5: Z-score로 이상치 탐지 [2분]

> 다섯 번째 실습입니다. Z-score로도 이상치를 탐지해봅시다.
>
> ```python
> mean = df_clean['생산량'].mean()
> std = df_clean['생산량'].std()
> z_scores = (df_clean['생산량'] - mean) / std
>
> outliers_z = np.abs(z_scores) > 2
> print(f"이상치 개수 (|Z|>2): {outliers_z.sum()}개")
> ```
>
> 두 방법의 결과가 비슷하게 나올 겁니다.

### 실습 6: 이상치 처리 [2분]

> 여섯 번째 실습입니다. 이상치를 처리해봅시다.
>
> ```python
> df_final = df_clean.copy()
> df_final['생산량'] = df_final['생산량'].clip(lower, upper)
>
> print(f"생산량 범위: {df_final['생산량'].min():.0f} ~ {df_final['생산량'].max():.0f}")
> ```
>
> `clip()` 함수로 상한과 하한을 적용했습니다. 2000이었던 값이 상한으로 잘렸죠.

### 실습 7: 전후 비교 [2분]

> 마지막 실습입니다. 처리 전후를 비교해봅시다.
>
> ```python
> fig, axes = plt.subplots(1, 2, figsize=(12, 5))
>
> axes[0].hist(df_clean['생산량'], bins=20, edgecolor='black')
> axes[0].set_title('처리 전 생산량')
>
> axes[1].hist(df_final['생산량'], bins=20, edgecolor='black')
> axes[1].set_title('처리 후 생산량')
>
> plt.show()
> ```
>
> 처리 후에 극단값이 사라진 게 보이시죠? 이게 전처리의 효과입니다.

---

### 정리 (3분)

#### 핵심 요약 [1.5분]

> 오늘 배운 내용을 정리하겠습니다.
>
> **결측치**: `isnull()`로 탐지하고, `dropna()`로 삭제하거나 `fillna()`로 대체합니다.
>
> **이상치**: IQR이나 Z-score로 탐지하고, `clip()`으로 클리핑하거나 대체합니다.
>
> **핵심 원칙**: 데이터를 먼저 이해하고, 도메인 지식을 활용하고, 전후를 반드시 비교하세요.

#### 주의사항 [0.5분]

> 주의할 점입니다.
>
> 결측치를 0으로 채우면 의미가 왜곡될 수 있습니다. 온도가 0도라는 게 무슨 의미일까요?
>
> 이상치를 무조건 제거하면 중요한 정보를 잃을 수 있습니다. 분석 목적을 항상 생각하세요.

#### 다음 차시 예고 [0.5분]

> 다음 8차시에서는 **스케일링과 인코딩**을 배웁니다.
>
> 변수의 크기를 맞추는 정규화, 표준화와 범주형 데이터를 숫자로 바꾸는 인코딩을 다룹니다.

#### 마무리 [0.5분]

> 오늘 데이터 전처리의 첫 번째 단계를 배웠습니다.
>
> 결측치와 이상치 처리는 모든 데이터 분석의 기본입니다. 잘 익혀두세요.
>
> 수고하셨습니다. 다음 시간에 뵙겠습니다!

---

## 강의 노트

### 준비물
- PPT 슬라이드 (slides.md)
- 실습 코드 파일 (code.py)
- 실습용 CSV 파일 (선택)

### 주의사항
- fillna의 inplace=True 사용 시 원본 변경됨
- 복사본 만들어서 작업하는 습관 강조
- clip()과 np.clip() 차이 설명

### 예상 질문
1. "결측치를 0으로 채우면 안 되나요?"
   → 데이터 의미에 따라 다름. 온도 0은 부적절, 불량수 0은 적절할 수 있음

2. "이상치를 제거하면 데이터가 너무 줄어드는데?"
   → 클리핑이나 대체 방법 사용. 삭제는 최후의 수단

3. "어떤 방법이 더 좋은가요? IQR vs Z-score"
   → 정규분포면 Z-score, 아니면 IQR이 더 강건함

4. "실무에서는 어떻게 하나요?"
   → 도메인 전문가와 협의, 자동화된 파이프라인 구축
