# [17차시] 시계열 예측 모델 - 강사 스크립트

## 강의 정보
- **차시**: 17차시 (25-30분)
- **유형**: 이론 + 실습
- **구성**: 이론 10분 + 실습 15-20분
- **대상**: 비전공자, AI 입문자, 제조업 종사자

---

## 이론편 (10분)

### 도입 (2분)

#### 인사 및 지난 시간 복습 [1분]

> 안녕하세요, 17차시를 시작하겠습니다.
>
> 지난 시간에 시계열 데이터의 기초를 배웠습니다. datetime 처리, dt 접근자, resample, rolling을 배웠죠.
>
> 오늘은 이 시계열 데이터로 **미래를 예측**하는 방법을 배웁니다.

#### 학습목표 안내 [1분]

> 오늘 수업을 마치면 다음 세 가지를 할 수 있습니다.
>
> 첫째, 특성 엔지니어링으로 시계열을 테이블로 변환합니다.
> 둘째, ML 모델로 시계열을 예측합니다.
> 셋째, MAE, RMSE, MAPE로 예측 성능을 평가합니다.

---

### 핵심 내용 (8분)

#### 시계열 예측이란? [1.5분]

> 시계열 예측은 **과거 데이터로 미래를 예측**하는 거예요.
>
> 제조 현장에서 많이 쓰입니다.
> - 생산량 예측 → 원자재 발주
> - 수요 예측 → 재고 관리
> - 설비 상태 예측 → 예방 정비
>
> 핵심은 과거 패턴을 학습해서 미래에 적용하는 거예요.

#### ML 기반 접근법 [1.5분]

> 시계열 예측에는 여러 방법이 있어요. ARIMA, Prophet 같은 전통적 방법도 있지만, 오늘은 **ML 기반 접근**을 배웁니다.
>
> 핵심 아이디어는 시계열 데이터를 **테이블 형태로 변환**해서 이미 배운 RandomForest를 적용하는 거예요.
>
> ```python
> 원래 시계열 → 특성 추가 → 테이블 데이터 → ML 모델
> ```
>
> 이걸 **특성 엔지니어링**이라고 합니다.

#### 특성 엔지니어링 [2분]

> 특성 엔지니어링은 세 가지로 나뉩니다.
>
> 첫째, **날짜 기반 특성**입니다.
> ```python
> df['월'] = df['날짜'].dt.month
> df['요일'] = df['날짜'].dt.dayofweek
> ```
>
> 둘째, **시차 특성(Lag)**입니다. 과거 값을 특성으로 씁니다.
> ```python
> df['lag_1'] = df['생산량'].shift(1)  # 어제 생산량
> ```
>
> 셋째, **롤링 특성**입니다. 이동평균 같은 통계량이에요.
> ```python
> df['ma_7'] = df['생산량'].shift(1).rolling(7).mean()
> ```

#### 데이터 누출 방지 [1.5min]

> 여기서 정말 중요한 게 있어요. **데이터 누출 방지**입니다.
>
> 롤링 특성을 만들 때 반드시 shift(1)을 먼저 해야 합니다.
>
> ```python
> # ❌ 잘못된 예
> df['ma_7'] = df['생산량'].rolling(7).mean()  # 오늘 값 포함!
>
> # ✅ 올바른 예
> df['ma_7'] = df['생산량'].shift(1).rolling(7).mean()  # 어제까지만!
> ```
>
> 이걸 어기면 테스트 점수는 좋은데 실제 예측은 완전히 실패해요. 매우 중요합니다.

#### 평가 지표 [1.5min]

> 시계열 예측 평가에는 MAE, RMSE, MAPE를 씁니다.
>
> **MAE**는 평균 절대 오차예요. 단위가 개수라서 직관적이죠.
>
> **RMSE**는 큰 오차에 민감합니다. 가끔 크게 틀리면 안 되는 경우에 중요해요.
>
> **MAPE**는 백분율 오차예요. 10% 이내면 매우 좋고, 20% 이내면 좋은 수준입니다.
>
> 제조 현장에서는 보통 MAPE 10~20% 이내를 목표로 합니다.

---

## 실습편 (15-20분)

### 실습 소개 [2분]

> 이제 실습 시간입니다. 생산량 예측 모델을 직접 만들어봅니다.
>
> **실습 목표**입니다.
> 1. 특성 엔지니어링을 합니다.
> 2. RandomForest로 예측합니다.
> 3. 평가하고 시각화합니다.
>
> **실습 환경**을 확인해주세요.
>
> ```python
> from sklearn.ensemble import RandomForestRegressor
> from sklearn.metrics import mean_absolute_error, mean_squared_error
> ```

### 실습 1: 데이터 준비 [2min]

> 첫 번째 실습입니다. 일별 생산 데이터를 생성합니다.
>
> 추세와 주간 패턴, 노이즈를 포함한 180일치 데이터예요.
>
> ```python
> trend = np.linspace(1000, 1100, n_days)  # 상승 추세
> seasonal = 50 * np.sin(2 * np.pi * np.arange(n_days) / 7)  # 주간 패턴
> ```

### 실습 2: 날짜 특성 [2min]

> 두 번째 실습입니다. 날짜 기반 특성을 만듭니다.
>
> ```python
> df['월'] = df.index.month
> df['요일'] = df.index.dayofweek
> df['주말'] = (df.index.dayofweek >= 5).astype(int)
> ```
>
> 주말 여부도 유용한 특성이에요. 주말에 생산량이 다를 수 있으니까요.

### 실습 3: 시차 특성 [2min]

> 세 번째 실습입니다. 시차 특성을 만듭니다.
>
> ```python
> df['lag_1'] = df['생산량'].shift(1)
> df['lag_7'] = df['생산량'].shift(7)
> ```
>
> lag_1이 가장 중요한 특성이 될 거예요. 어제 생산량이 오늘과 가장 관련 있거든요.

### 실습 4: 롤링 특성 [2min]

> 네 번째 실습입니다. 롤링 특성을 만듭니다.
>
> ```python
> df['ma_7'] = df['생산량'].shift(1).rolling(7).mean()
> df['std_7'] = df['생산량'].shift(1).rolling(7).std()
> ```
>
> 꼭 shift(1)을 먼저 하세요! 이거 빼먹으면 데이터 누출이에요.

### 실습 5: 결측치 제거 [1min]

> 다섯 번째 실습입니다. 결측치를 제거합니다.
>
> ```python
> df = df.dropna()
> ```
>
> shift와 rolling 때문에 처음 몇 행은 NaN이 생겨요. 이걸 제거합니다.

### 실습 6: 시간 기준 분할 [2min]

> 여섯 번째 실습입니다. 중요한 부분이에요.
>
> ```python
> split_date = '2024-05-01'
> train = df[df.index < split_date]
> test = df[df.index >= split_date]
> ```
>
> 시계열은 반드시 시간 기준으로 분할해야 합니다. train_test_split 쓰면 안 돼요!

### 실습 7: 모델 학습 [2min]

> 일곱 번째 실습입니다. RandomForestRegressor로 학습합니다.
>
> ```python
> model = RandomForestRegressor(n_estimators=100, random_state=42)
> model.fit(X_train, y_train)
> predictions = model.predict(X_test)
> ```
>
> 분류가 아니라 회귀 문제니까 Regressor를 씁니다.

### 실습 8: 성능 평가 [2min]

> 여덟 번째 실습입니다. MAE, RMSE, MAPE를 계산합니다.
>
> ```python
> mae = mean_absolute_error(y_test, predictions)
> rmse = np.sqrt(mean_squared_error(y_test, predictions))
> mape = np.mean(np.abs((y_test - predictions) / y_test)) * 100
> ```
>
> MAPE가 10% 이내면 좋은 결과예요!

### 실습 9: 특성 중요도 [2min]

> 마지막 실습입니다. 어떤 특성이 중요한지 봅니다.
>
> ```python
> importance = model.feature_importances_
> ```
>
> 보통 lag_1이 가장 중요하게 나와요. 어제 생산량이 오늘 예측에 가장 큰 영향을 주거든요.

---

### 정리 (3분)

#### 핵심 요약 [1.5min]

> 오늘 배운 내용을 정리하겠습니다.
>
> **특성 엔지니어링**으로 시계열을 테이블로 변환했습니다. 날짜 특성, 시차 특성, 롤링 특성을 만들었어요.
>
> **데이터 누출 방지**가 핵심입니다. 롤링 특성 만들 때 shift(1)을 먼저 하세요.
>
> **시간 기준 분할**로 과거 데이터로 학습하고 미래 데이터로 평가했습니다.
>
> **MAPE** 10~20% 이내가 좋은 예측입니다.

#### 다음 차시 예고 [1min]

> 다음 18차시에서는 **딥러닝 입문**을 배웁니다.
>
> 신경망의 기초 개념, 뉴런, 층, 활성화 함수를 알아봅니다. 드디어 딥러닝의 세계로 들어갑니다!

#### 마무리 [0.5min]

> 과거 데이터로 미래를 예측하는 방법을 배웠습니다. 수고하셨습니다!

---

## 강의 노트

### 준비물
- PPT 슬라이드 (slides.md)
- 실습 코드 파일 (code.py)

### 주의사항
- shift(1) 중요성 반복 강조
- 시간 기준 분할 필수
- MAPE 해석 기준 제시

### 예상 질문
1. "shift(1)을 왜 해야 하나요?"
   → 안 하면 오늘 값이 포함되어 미래 정보 누출. 실제 예측 때 사용 불가

2. "MAPE가 너무 높아요"
   → 특성 추가 (더 많은 lag, 외부 변수), 모델 튜닝, 데이터 품질 확인

3. "여러 날 앞을 예측하려면?"
   → 재귀적 예측 또는 직접 예측 모델. 입문 단계에서는 1일 후 집중

4. "딥러닝이 더 좋지 않나요?"
   → 데이터가 충분하면 좋을 수 있지만, 시계열은 ML도 충분히 강력함
