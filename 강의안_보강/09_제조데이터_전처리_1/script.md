# [9차시] 제조 데이터 전처리 (1) - 강사 스크립트

## 수업 개요

| 항목 | 내용 |
|------|------|
| 차시 | 9차시 |
| 주제 | 제조 데이터 전처리 (1): 결측치와 이상치 |
| 시간 | 30분 (이론 15분 + 실습 15분) |
| 목표 | 결측치/이상치 탐지 및 처리 방법 습득 |

---

## 시간 배분

| 구분 | 시간 | 내용 |
|------|------|------|
| 도입 | 2분 | 전처리의 중요성, 학습 목표 |
| 이론 1 | 5분 | 결측치 탐지 및 처리 |
| 이론 2 | 4분 | 이상치 탐지 방법 |
| 이론 3 | 4분 | 전처리 전략 선택 |
| 실습 | 13분 | 종합 전처리 실습 |
| 정리 | 2분 | 핵심 요약, 다음 차시 예고 |

---

## 도입 (2분)

### 슬라이드 1-2: 전처리의 중요성

**강사 멘트:**

> "안녕하세요, 9차시 수업을 시작하겠습니다."
>
> "오늘은 데이터 분석에서 가장 많은 시간이 소요되는 **전처리** 작업을 배웁니다."
>
> "실제 데이터 분석 프로젝트에서 전처리가 차지하는 비중이 얼마나 될까요?"
>
> *(학습자 답변 유도)*
>
> "네, 보통 **60-80%** 정도가 전처리에 소요됩니다. 데이터가 깨끗해야 좋은 모델을 만들 수 있기 때문이죠."

### 슬라이드 3: Garbage In, Garbage Out

**강사 멘트:**

> "데이터 분석에서 유명한 격언이 있습니다. **'Garbage In, Garbage Out'**"
>
> "쓰레기 같은 데이터를 넣으면 쓰레기 같은 결과가 나온다는 뜻입니다."
>
> "아무리 좋은 알고리즘을 써도 데이터 품질이 나쁘면 좋은 결과를 얻을 수 없어요."
>
> "그래서 전처리가 정말 중요합니다."

### 슬라이드 4: 학습 목표

**강사 멘트:**

> "오늘 배울 내용은 크게 세 가지입니다."
>
> "첫째, **결측치 탐지 및 처리** - 비어있는 데이터를 찾고 처리하는 방법"
>
> "둘째, **이상치 탐지 방법 적용** - IQR과 Z-score로 이상치를 찾는 방법"
>
> "셋째, **상황에 맞는 전처리 전략 선택** - 언제 어떤 방법을 쓸지 판단하는 기준"
>
> "이 세 가지를 익히면 대부분의 전처리 작업을 수행할 수 있습니다."

---

## Part 1: 결측치 탐지 및 처리 (5분)

### 슬라이드 5-6: 결측치란?

**강사 멘트:**

> "먼저 결측치에 대해 알아보겠습니다."
>
> "결측치는 데이터에서 값이 누락된 부분을 말합니다."
>
> "제조 현장에서 결측치가 발생하는 이유는 다양합니다."
>
> "센서 고장, 통신 오류, 수동 입력 누락, 시스템 장애 등이 대표적이죠."
>
> "Python에서는 결측치를 **NaN**(Not a Number)으로 표시합니다."

### 슬라이드 7-8: 결측치 탐지

**강사 멘트:**

> "결측치를 탐지하는 방법을 알아보겠습니다."
>
> "Pandas에서는 `isnull()` 또는 `isna()` 메서드를 사용합니다."
>
> ```python
> # 결측치 확인
> df.isnull()        # 각 셀별 True/False
> df.isnull().sum()  # 컬럼별 결측치 개수
> ```
>
> "전체 현황을 한눈에 보려면 `info()` 메서드를 사용하면 됩니다."
>
> "Non-Null Count를 보면 어떤 컬럼에 결측치가 있는지 바로 알 수 있어요."

### 슬라이드 9-10: 결측치 비율 확인

**강사 멘트:**

> "결측치 개수도 중요하지만, **비율**이 더 중요합니다."
>
> "결측치가 100개라고 해도, 전체가 10,000개면 1%에 불과하지만"
>
> "전체가 200개면 50%나 되는 거잖아요."
>
> ```python
> # 결측치 비율 계산
> missing_ratio = df.isnull().sum() / len(df) * 100
> ```
>
> "일반적으로 결측치 비율이 **5% 이하**면 큰 문제 없이 처리할 수 있고,"
>
> "**30% 이상**이면 해당 컬럼 사용 여부를 재고해야 합니다."

### 슬라이드 11-13: 결측치 처리 방법

**강사 멘트:**

> "결측치를 처리하는 방법은 크게 두 가지입니다."
>
> "첫째, **삭제** - 결측치가 있는 행이나 열을 제거"
>
> "둘째, **대체** - 결측치를 다른 값으로 채우기"
>
> ```python
> # 삭제
> df.dropna()           # 결측치 있는 행 삭제
> df.dropna(axis=1)     # 결측치 있는 열 삭제
>
> # 대체
> df.fillna(0)          # 0으로 대체
> df.fillna(df.mean())  # 평균으로 대체
> df.fillna(method='ffill')  # 앞 값으로 채우기
> ```
>
> "삭제는 간단하지만 데이터 손실이 발생합니다."
>
> "대체는 데이터를 보존하지만, 적절한 값을 선택해야 합니다."

### 슬라이드 14-15: 대체 전략 선택

**강사 멘트:**

> "어떤 값으로 대체할지는 **데이터 특성**에 따라 달라집니다."
>
> "**수치형 데이터**라면:"
> - "정규분포 → 평균(mean)"
> - "왜도가 크면 → 중앙값(median)"
>
> "**범주형 데이터**라면:"
> - "최빈값(mode)으로 대체"
>
> "**시계열 데이터**라면:"
> - "앞 값으로 채우기(ffill) 또는 선형 보간(interpolate)"

---

## Part 2: 이상치 탐지 방법 적용 (4분)

### 슬라이드 16-17: 이상치란?

**강사 멘트:**

> "이번에는 이상치에 대해 알아보겠습니다."
>
> "이상치는 다른 데이터들과 동떨어진 값을 말합니다."
>
> "예를 들어, 온도 데이터가 20~30도 사이인데 갑자기 -100도나 500도가 나온다면?"
>
> "이건 분명 뭔가 잘못된 값이겠죠. 이런 것이 이상치입니다."
>
> "하지만 주의할 점! **이상치가 항상 잘못된 값은 아닙니다.**"
>
> "실제로 발생한 극단적인 상황일 수도 있어요."

### 슬라이드 18-20: IQR 방법

**강사 멘트:**

> "이상치를 탐지하는 첫 번째 방법은 **IQR 방법**입니다."
>
> "IQR은 Interquartile Range, 사분위 범위를 의미합니다."
>
> "데이터를 정렬했을 때:"
> - "Q1: 하위 25% 지점"
> - "Q3: 상위 25% 지점 (하위 75%)"
> - "IQR = Q3 - Q1"
>
> "이상치 기준은:"
> - "하한: Q1 - 1.5 × IQR"
> - "상한: Q3 + 1.5 × IQR"
>
> "이 범위를 벗어나면 이상치로 판단합니다."

### 슬라이드 21-22: IQR 코드

**강사 멘트:**

> "IQR 방법을 코드로 구현해보겠습니다."
>
> ```python
> Q1 = df['temperature'].quantile(0.25)
> Q3 = df['temperature'].quantile(0.75)
> IQR = Q3 - Q1
>
> lower = Q1 - 1.5 * IQR
> upper = Q3 + 1.5 * IQR
>
> outliers = df[(df['temperature'] < lower) |
>               (df['temperature'] > upper)]
> ```
>
> "quantile 메서드로 Q1, Q3를 구하고, 범위를 계산합니다."
>
> "범위를 벗어나는 데이터를 필터링하면 이상치를 찾을 수 있습니다."

### 슬라이드 23-25: Z-score 방법

**강사 멘트:**

> "두 번째 방법은 **Z-score 방법**입니다."
>
> "6차시에서 배운 Z-score를 기억하시죠?"
>
> "Z-score는 평균에서 얼마나 떨어져 있는지를 표준편차 단위로 나타낸 값입니다."
>
> "Z = (x - μ) / σ"
>
> "일반적으로 |Z| > 2 또는 |Z| > 3이면 이상치로 판단합니다."
>
> "정규분포 가정 하에서 |Z| > 3인 데이터는 전체의 0.3%에 불과합니다."

### 슬라이드 26-27: Z-score 코드

**강사 멘트:**

> "Z-score 방법을 코드로 구현해보겠습니다."
>
> ```python
> from scipy import stats
>
> z_scores = stats.zscore(df['temperature'])
> outliers = df[np.abs(z_scores) > 3]
> ```
>
> "scipy의 zscore 함수를 사용하면 간단합니다."
>
> "절대값이 3을 초과하는 데이터를 이상치로 추출합니다."

### 슬라이드 28: IQR vs Z-score

**강사 멘트:**

> "두 방법의 차이점을 정리해보겠습니다."
>
> "**IQR 방법**은:"
> - "정규분포 가정 불필요"
> - "분포가 왜곡된 데이터에도 적용 가능"
> - "극단값에 덜 민감"
>
> "**Z-score 방법**은:"
> - "정규분포 가정 필요"
> - "통계적 해석이 명확 (99.7% 범위)"
> - "계산이 간단"
>
> "데이터 분포를 먼저 확인하고 적절한 방법을 선택하세요."

---

## Part 3: 상황에 맞는 전처리 전략 선택 (4분)

### 슬라이드 29-30: 이상치 처리 전략

**강사 멘트:**

> "이상치를 찾았다면, 어떻게 처리할까요?"
>
> "크게 세 가지 방법이 있습니다."
>
> "**1. 제거** - 이상치 행 삭제"
> - "명백한 오류일 때 사용"
> - "데이터 손실 발생"
>
> "**2. 대체** - 경계값으로 clipping"
> - "분석에 포함하되 영향력 제한"
> - "데이터 보존"
>
> "**3. 유지** - 그대로 분석"
> - "실제 발생한 극단값일 때"
> - "이상치 자체가 분석 목적일 때"

### 슬라이드 31-33: Clipping 기법

**강사 멘트:**

> "**Clipping**은 가장 많이 쓰는 이상치 처리 기법입니다."
>
> "이상치를 제거하지 않고, 경계값으로 대체하는 방법이에요."
>
> ```python
> # 하한/상한으로 clipping
> df['temperature'] = df['temperature'].clip(lower=10, upper=50)
> ```
>
> "10도 미만은 10도로, 50도 초과는 50도로 변환됩니다."
>
> "데이터 건수는 유지하면서 극단값의 영향을 줄일 수 있어요."

### 슬라이드 34-35: 플래그 추가

**강사 멘트:**

> "이상치를 제거하지 않고 **플래그**만 추가하는 방법도 있습니다."
>
> ```python
> # 이상치 플래그 추가
> df['is_outlier'] = (df['temperature'] < lower) |
>                    (df['temperature'] > upper)
> ```
>
> "이렇게 하면 나중에 이상치만 따로 분석할 수도 있고,"
>
> "모델 학습 시 제외할 수도 있습니다."
>
> "원본 데이터를 보존하면서 유연하게 활용할 수 있는 장점이 있어요."

### 슬라이드 36-38: 전처리 순서

**강사 멘트:**

> "전처리를 할 때 순서도 중요합니다."
>
> "일반적인 순서는:"
>
> "**1단계**: 결측치 탐지 및 처리"
> - "결측치가 있으면 통계 계산이 안 되므로 먼저 처리"
>
> "**2단계**: 이상치 탐지 및 처리"
> - "결측치 처리 후 정확한 통계치로 이상치 탐지"
>
> "**3단계**: 추가 전처리"
> - "스케일링, 인코딩 등 (다음 차시에서 배움)"
>
> "순서를 바꾸면 결과가 달라질 수 있으니 주의하세요."

### 슬라이드 39-40: 전처리 전략 선택 기준

**강사 멘트:**

> "어떤 전략을 선택할지는 상황에 따라 다릅니다."
>
> "**결측치가 적을 때 (5% 미만)**:"
> - "삭제해도 무방"
>
> "**결측치가 많을 때 (5-30%)**:"
> - "적절한 값으로 대체"
>
> "**이상치가 오류일 때**:"
> - "제거 또는 clipping"
>
> "**이상치가 실제 값일 때**:"
> - "유지하거나 별도 분석"
>
> "중요한 건 **왜 이런 값이 나왔는지** 먼저 파악하는 것입니다."

---

## 실습 (13분)

### 슬라이드 41-42: 실습 안내

**강사 멘트:**

> "이제 실습을 해보겠습니다."
>
> "제조 센서 데이터를 사용해서:"
> 1. "결측치를 탐지하고 처리"
> 2. "IQR과 Z-score로 이상치 탐지"
> 3. "적절한 전처리 전략 적용"
>
> "순서대로 따라해보세요."

### 실습 1: 데이터 준비 (2분)

**강사 멘트:**

> "먼저 실습용 데이터를 생성합니다."
>
> ```python
> import pandas as pd
> import numpy as np
>
> # 결측치와 이상치가 포함된 데이터 생성
> np.random.seed(42)
> data = {
>     'temperature': [25, 26, np.nan, 27, 28, -50, 29, 30, np.nan, 150],
>     'pressure': [100, 101, 102, np.nan, 103, 104, 105, 500, 106, 107],
>     'quality': ['양품', '양품', '불량', np.nan, '양품', '불량', '양품', '양품', '양품', '불량']
> }
> df = pd.DataFrame(data)
> ```
>
> "온도, 압력, 품질 데이터에 결측치와 이상치를 넣어놨습니다."

### 실습 2: 결측치 탐지 (2분)

**강사 멘트:**

> "결측치를 확인해봅시다."
>
> ```python
> # 결측치 현황
> print(df.isnull().sum())
> print()
> print(f"결측치 비율:\n{df.isnull().sum() / len(df) * 100}%")
> ```
>
> "temperature에 2개, pressure에 1개, quality에 1개의 결측치가 있네요."

### 실습 3: 결측치 처리 (3분)

**강사 멘트:**

> "결측치를 처리해보겠습니다."
>
> ```python
> # 수치형은 중앙값으로, 범주형은 최빈값으로 대체
> df['temperature'] = df['temperature'].fillna(df['temperature'].median())
> df['pressure'] = df['pressure'].fillna(df['pressure'].median())
> df['quality'] = df['quality'].fillna(df['quality'].mode()[0])
>
> print(df.isnull().sum())  # 결측치 확인
> ```
>
> "모든 결측치가 처리되었는지 확인하세요."

### 실습 4: 이상치 탐지 - IQR (3분)

**강사 멘트:**

> "IQR 방법으로 온도 이상치를 탐지해봅시다."
>
> ```python
> # IQR 계산
> Q1 = df['temperature'].quantile(0.25)
> Q3 = df['temperature'].quantile(0.75)
> IQR = Q3 - Q1
>
> lower = Q1 - 1.5 * IQR
> upper = Q3 + 1.5 * IQR
>
> print(f"정상 범위: {lower:.1f} ~ {upper:.1f}")
>
> # 이상치 확인
> outliers = df[(df['temperature'] < lower) | (df['temperature'] > upper)]
> print(f"이상치 개수: {len(outliers)}")
> ```
>
> "-50도와 150도가 이상치로 탐지되어야 합니다."

### 실습 5: 이상치 처리 - Clipping (3분)

**강사 멘트:**

> "이상치를 clipping으로 처리해보겠습니다."
>
> ```python
> # Clipping 적용
> df['temperature_cleaned'] = df['temperature'].clip(lower=lower, upper=upper)
>
> # 결과 비교
> print("원본 vs 처리 후:")
> print(df[['temperature', 'temperature_cleaned']])
> ```
>
> "-50도는 하한값으로, 150도는 상한값으로 대체됩니다."
>
> "원본 컬럼은 유지하고 새 컬럼에 결과를 저장했습니다."
>
> "이렇게 하면 나중에 비교할 수 있어요."

---

## 정리 (2분)

### 슬라이드 48-49: 핵심 요약

**강사 멘트:**

> "오늘 배운 내용을 정리하겠습니다."
>
> "**결측치 처리**:"
> - "`isnull()`, `dropna()`, `fillna()`"
> - "수치형은 평균/중앙값, 범주형은 최빈값"
>
> "**이상치 탐지**:"
> - "IQR: Q1 - 1.5×IQR ~ Q3 + 1.5×IQR"
> - "Z-score: |Z| > 2 또는 3"
>
> "**처리 전략**:"
> - "제거, clipping, 플래그 추가"
> - "상황에 맞게 선택"

### 슬라이드 50: 다음 차시 예고

**강사 멘트:**

> "다음 9차시에서는 **전처리 2탄**을 배웁니다."
>
> "스케일링, 인코딩, 특성 엔지니어링을 다룰 예정입니다."
>
> "오늘 수고하셨습니다!"

---

## 예상 질문 및 답변

### Q1: 결측치와 이상치를 동시에 처리할 때 순서가 중요한가요?

**A:** 네, 순서가 중요합니다. **결측치를 먼저 처리**해야 합니다. 이상치 탐지 시 평균, 표준편차 등의 통계치가 필요한데, 결측치가 있으면 이 계산이 정확하지 않습니다. 결측치 처리 후 정확한 통계치를 기반으로 이상치를 탐지하세요.

### Q2: IQR 방법에서 1.5 대신 다른 값을 쓸 수 있나요?

**A:** 물론입니다. 1.5는 일반적으로 사용되는 값이지만, 상황에 따라 조절할 수 있습니다:
- **1.5**: 표준적인 이상치 탐지
- **3.0**: 극단적인 이상치만 탐지 (더 관대)
- **1.0**: 더 엄격한 이상치 탐지

제조 현장에서는 품질 기준에 따라 이 값을 조정하기도 합니다.

### Q3: 결측치가 30% 이상이면 어떻게 해야 하나요?

**A:** 여러 가지 선택지가 있습니다:
1. **해당 컬럼 제외**: 분석에서 제외하는 것이 가장 안전
2. **다른 컬럼으로 대체**: 유사한 정보를 가진 다른 컬럼 활용
3. **고급 대체 기법**: KNN 대체, 회귀 기반 대체 등 (고급 기법)
4. **원인 파악**: 왜 결측치가 많은지 먼저 조사

데이터 수집 과정을 개선하는 것이 근본적인 해결책입니다.

### Q4: 이상치가 실제로 발생한 극단값인지 오류인지 어떻게 구분하나요?

**A:** 몇 가지 방법이 있습니다:
1. **도메인 지식 활용**: 온도가 음수일 수 없는 공정이라면 명백한 오류
2. **시간대 확인**: 장비 점검 시간에 발생했다면 오류 가능성
3. **패턴 분석**: 비슷한 이상치가 반복되면 실제 현상일 가능성
4. **현장 확인**: 의심스러우면 현장에서 직접 확인

**결론**: 이상치를 무조건 제거하지 말고, 왜 발생했는지 먼저 파악하세요.

### Q5: fillna에서 mean()과 median() 중 어떤 것을 써야 하나요?

**A:** 데이터 분포에 따라 다릅니다:
- **정규분포(대칭)**: `mean()` 사용
- **왜도가 큰 분포(비대칭)**: `median()` 사용

이상치가 있는 경우에는 `median()`이 더 안정적입니다. 평균은 이상치에 민감하지만, 중앙값은 영향을 덜 받기 때문입니다.

---

## 강사 노트

### 시연 시 주의사항

1. **결측치 시각화**: 실습 전 heatmap으로 결측치 패턴을 보여주면 이해도 향상
   ```python
   import seaborn as sns
   sns.heatmap(df.isnull(), cbar=False)
   ```

2. **박스플롯 활용**: 이상치 탐지 전후로 boxplot 비교
   ```python
   df.boxplot(column='temperature')
   ```

3. **실제 사례 강조**: 제조 현장에서 결측치/이상치로 인한 문제 사례 공유

### 학습자 수준별 가이드

- **초급자**: dropna(), fillna(), clip() 위주로 설명
- **중급자**: IQR, Z-score 계산 과정 상세 설명
- **고급자**: 다양한 대체 전략, 전처리 파이프라인 구성 언급

### 추가 참고 자료

- pandas 공식 문서: https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.fillna.html
- scipy stats: https://docs.scipy.org/doc/scipy/reference/stats.html
